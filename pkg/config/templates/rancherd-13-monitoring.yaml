bootstrapResources:
- apiVersion: management.cattle.io/v3
  kind: ManagedChart
  metadata:
    name: rancher-monitoring
    namespace: fleet-local
  spec:
    chart: rancher-monitoring
    version: {{ .MonitoringChartVersion }}
    defaultNamespace: cattle-monitoring-system
    repoName: harvester-charts
    targets:
    - clusterName: local
      clusterSelector:
        matchExpressions:
        - key: provisioning.cattle.io/unmanaged-system-agent
          operator: DoesNotExist
    values:
      alertmanager:
        enabled: false
      grafana:
        persistence:
          enabled: true
          size: "10"
          storageClassName: longhorn
          type: pvc
          accessModes:
          - ReadWriteOnce
      prometheus:
        prometheusSpec:
          evaluationInterval: 1m
          resources:
            requests:
              cpu: 500m
          retention: 5d
          retentionSize: 50GiB
          scrapeInterval: 1m
          storageSpec:
            volumeClaimTemplate:
              spec:
                accessModes:
                - ReadWriteOnce
                resources:
                  requests:
                    storage: 50Gi
                storageClassName: longhorn
                volumeMode: Filesystem
# ManagedChart's resources will have a prefix "mcc-" added to their name when they are installed.
# This would break monitoring dashboard because GUI expects a service named
# "rancher-monitoring-grafana" to provide Grafana service, not "mcc-rancher-monitoring-grafana".
# To fix this issue, we need to add a service with correct name and points to Grafana Pods.
- apiVersion: v1
  kind: Service
  metadata:
    name: rancher-monitoring-grafana
    namespace: cattle-monitoring-system
  spec:
    selector:
      app.kubernetes.io/instance: mcc-rancher-monitoring
      app.kubernetes.io/name: grafana
    ports:
    - protocol: TCP
      port: 80
      targetPort: 8080
